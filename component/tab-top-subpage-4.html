<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
			<!--自定义样式-->
		<link rel="stylesheet" type="text/css" href="../css/style.css"/>
		<link rel="stylesheet" type="text/css" href="../css/component/list-style.css"/>
		<style type="text/css">
		.mui-table-view .mui-media-object {
			margin-right: 5px;
		}
		</style>
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
							<!--数据列表-->
							<ul class="mui-table-view">
								<li class="mui-table-view-cell mui-media">
									<a href="javascript:;">
										<img class="mui-media-object mui-pull-left" src="../images/shuijiao.jpg">
										<div class="mui-media-object mui-pull-right">
											<span class="mui-badge mui-badge-primary">形象進度</span>
										</div>
										<div class="mui-media-body">
											<p class='mui-ellipsis color-black'>能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>
											<p class='mui-ellipsis'><span class="span-left">2017-07-29</span><span class="span-right">F123456</span></p>
										</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media">
									<a href="javascript:;">
										<img class="mui-media-object mui-pull-left" src="../images/shuijiao.jpg">
										<div class="mui-media-object mui-pull-right">
											<span class="mui-badge mui-badge-success">簽證工程</span>
										</div>
										<div class="mui-media-body">
											<p class='mui-ellipsis color-black'>能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>
											<p class='mui-ellipsis'><span class="span-left">2017-07-29</span><span class="span-right">F123456</span></p>
										</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media">
									<a href="javascript:;">
										<img class="mui-media-object mui-pull-left" src="../images/shuijiao.jpg">
										<div class="mui-media-object mui-pull-right">
											<span class="mui-badge">其他</span>
										</div>
										<div class="mui-media-body">
											<p class='mui-ellipsis color-black'>能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>
											<p class='mui-ellipsis'><span class="span-left">2017-07-29</span><span class="span-right">F123456</span></p>
										</div>
									</a>
								</li>
							
							</ul>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/dataFormat.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/commonidentify.js" type="text/javascript" charset="utf-8"></script>
		<script>
			mui.init({
				swipeBack: false,
				keyEventBind: {
					backbutton: false //关闭back按键监听
				},
				pullRefresh: {
					container: '#pullrefresh',
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
			mui.plusReady(function(){
				console.log('等待显示'+plus.storage.getItem('waitingShow'))
				console.log(plus.storage.getItem('waitingShow')==true)
				if(plus.storage.getItem('waitingShow')==true){
				plus.nativeUI.showWaiting('拼命獲取數據中...');
				mui.ajax('http://supplier.foxconn.com/yupin/api/ImageProgress/GetList',{
					data:{ userID:"F3229346",Page:"1",pageSize:"5" },
					dataType:'json',//服务器返回json格式数据
					type:'get',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					success:function(response){
						//获得服务器响应
						var alldata=response;
						console.log(response)
						var table = document.body.querySelector('.mui-table-view');
						for (let data of alldata) {
							if(data.status){
							let li = document.createElement('li');
							li.className = 'mui-table-view-cell';
							li.innerHTML = `<li class="mui-table-view-cell mui-media">
								<input hidden id=${data.apply_id}>
								<input hidden class="btn-status" value=${data.status}>
								<a href="javascript:;">
									<img class="mui-media-object mui-pull-left" src=${data.imgUrl}>
									<div class="mui-media-object mui-pull-right">
											<span class="${getStatusBadge(data.status)}">${getStatus(data.status)}</span>
									</div>
									<div class="mui-media-body">
										<p class='mui-ellipsis color-black'>${data.remark}</p>
										<p class='mui-ellipsis'><span class="span-left">${new Date(data.update_date).Format('yyyy-MM-dd')}</span><span class="span-right">${data.userName}</span></p>
									</div>
								</a>
								</li>`;
							table.appendChild(li);
							}
						}
						setTimeout(function(){
							plus.nativeUI.closeWaiting();
						},500)
					},
					error:function(xhr,type,errorThrown){
						console.log(xhr)
						console.log(type)
						console.log(errorThrown)
						plus.nativeUI.closeWaiting();
						plus.nativeUI.toast( "请求错误!");
					}
				});
				}
			})
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					/*mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					for (var i = cells.length, len = i + 20; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						li.innerHTML = '<a class="mui-navigate-right">社会-Item ' + (i + 1) + '</a>';
						table.appendChild(li);
					}*/
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					mui.get('http://supplier.foxconn.com/yupin/api/ImageProgress/GetList',{ userID:"F3229346",Page:"1",pageSize:"6" } ,function(response){
						//获得服务器响应
						var alldata=response.data;
						//console.log(data.msg)
						var table = document.body.querySelector('.mui-table-view');
						for (let data of alldata) {
							let li = document.createElement('li');
							li.className = 'mui-table-view-cell';
							li.innerHTML = '<div class="mui-table">'+
												'<div class="mui-table-cell mui-col-xs-10">'+
													'<h4 class="mui-ellipsis">'+data.projectName+'</h4>'+
									
													'<p class="mui-h6 mui-ellipsis">'+data.remark+'</p>'+
												'</div>'+
												'<div class="mui-table-cell mui-col-xs-2 mui-text-right">'+
													'<span class="mui-h5">'+data.update_date+'</span>'+
												'</div>'+
											'</div>';
							table.appendChild(li);
						}
						mui('#pullrefresh').pullRefresh().endPullupToRefresh();
					},'json'
				);
				}, 1000);
			}
			//单击事件
			mui('body').on('tap','.mui-table-view li', function(e){
				var h=this.getElementsByTagName('h4');
				console.log('单机了'+h[0].innerHTML );
				mui.openWindowWithTitle({
				    url:'edit.html',
				    id:'edit'
				},{
					backgroundColor:"#f4645f",//导航栏背景色
				    title:{//标题配置
				        text:h[0].innerHTML,//标题文字
				        styles:{//绘制文本样式，参考：http://www.html5plus.org/doc/zh_cn/nativeobj.html#plus.nativeObj.TextStyles
				            color:"#f0f0f0",
				            align:"center",
				            family:"'Helvetica Neue',Helvetica,sans-serif",
				            size:"17px",
				            style:"normal",
				            weight:"normal",
				            fontSrc:""
				        },
				    },
				    back:{//左上角返回箭头
				        image:{
				            base64Data:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABd0lEQVR4Xu3Y4Q2CQAwFYG4UN8FJlI3cQEbRDXQTN8BeIgkxhPtB3/WVKwm/iCfvu1ZzTV3jV2o8fxcAUQGNC0QLNF4A8SMYLRAt0LhAtEDjBcD7LzBN0002Z0wpvZCbRNkCEn6U0Be5P3KfkQh0AIvw88ZDEagAVsLPCE+pgh7RCjQAG+HfErwXgFwJ6hcFgFX4rGkOYBneHMA6vCkAQ3gzAJbwJgBM4asDsIWvCsAYvhoAa/gqAMzh4QDs4aEAHsLDALyEhwB4Cq8O4C28KoCEv8qC95UDez7Hn1Dn+b0DAtXj8EYF5OHmsPdlEZ9XBcgv6A1BHcAbAgTAEwIMwAsCFMADAhyAHaEKADNCNQBWhKoAjAjVAdgQTACYEMwAWBBMARgQzAGsESgALBFoAKwQqAA2EAYZqIwuBiIaL/k3VIGFV50JagRfrvFDeKB2fv4uuhbQhiytFwAloaM/jwo4+g6X8kUFlISO/jwq4Og7XMrXfAV8AXit4EEot4OAAAAAAElFTkSuQmCC'
				        }
				    }
				})
			})
		</script>
	</body>

</html>